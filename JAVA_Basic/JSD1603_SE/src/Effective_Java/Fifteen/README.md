# 15. 使类和成员的可访问性最小化
> 一个设计良好的**组件(field)**隐藏了它的所有实现细节，干净地将它的 API 与它的实现分离开来。
> 组件只通过它们的 API 进行通信，并且对彼此的内部工作一无所知。这一概念，被称为信息隐藏或封装，是软件设计的基本原则[Parnas72]
## 优点：
- 信息隐藏很重要有很多原因，其中大部分来源于它将组成系统的组件分离开来，允许它们被独立地开发，测试，
  优化，使用，理解和修改
- 信息隐藏增加了软件重用，因为松耦合的组件通常在除开发它们之外的其他环境中证明是有用
  的。
- 隐藏信息降低了构建大型系统的风险，因为即使系统不能运行，各个独立的组件也可能是可用的。
## Java 提供信息隐藏机制：
- **访问控制机制**（access control mechanism）[JLS，6.6] 指定了类，接口和 成员的可访问性
  - 让每个**类或成员尽可能地不可访问**，使用尽可能低的访问级别，与你正在编写的软件的对应功能保持一致。
    - **顶层**（非嵌套的）*类*和*接口*，只有两个可能的访问级别:包级 **私有**和**公共**的
      - **设置为包级私有**，可以将其作为实现的一部分，而不是导出的 API，你可
        以修改它、替换它，或者在后续版本中消除它，而不必担心损害现有的客户端。
      - 公共类是包的 API 的一部分，而包级私有的顶级类已经是这个包实现的一部分了
## 对于成员 (属性、方法、嵌套类和嵌套接口)，有四种可能的访问级别，在这里，按照可访问性从小到大列出：
private —— 该成员只能在声明它的顶级类内访问。  
package-private(默认) —— 成员可以从被声明的包中的任何类中访问。从技术上讲，如果没有指定访问修饰符 (接口成
员除外，它默认是公共的)，这是默认访问级别。  
protected —— 成员可以从被声明的类的子类中访问（受一些限制，JLS，6.6.2），以及它声明的包中的任何类。  
public —— 该成员可以从任何地方被访问  
### 注意：
1. 在仔细设计你的类的公共 API 之后，你的反应应该是让所有其他成员设计为私有的。只有当同一个包中的其他类
真的需要访问成员时，需要删除私有修饰符，从而使成员包成为包级私有的。如果你发现自己经常这样做，你应该
重新检查你的系统的设计，看看另一个分解可能产生更好的解耦的类。
2. **私有成员**和**包级私有成员**都是类实现的一部分，通常不会影响其导出的 API
3. 但是，如果类实现 Serializable 接口（条目 86 和 87），则这些属性可以“泄漏（leak）”到导出的 API 中
4. 如果一个方法重写一个超类方法，那么它在子类中的访问
  级别就**不能低于**父类中的访问级别[JLS，8.4.8.3]。 这对于确保子类的实例在父类的实例可用的地方是可用的（Liskov
  替换原则，见条目 15）是必要的。 如果违反此规则，编译器将在尝试编译子类时生成错误消息。
5. 如果属性被公共(的危害，如果想安全、线程安全！)：
  - 实例属性是非 final 的，或者是对可变对象的引用，那么通过将其公开，您将放弃执行涉及限制可存储在字段(field)中的不变值的能力。
  这意味着你放弃了该属性的不变量的能力——任何外部都能修改该属性;当属性被修改时，就不能采取做任何操作的能力(因为值随时在变化着)，**因此公共可变属性的类通常不是线程安全的**
    - 但有一个例外：**常量**
      - 你可以用public static final 属性暴露常量，因为它包含基本类型的值或对不可变对象的引用，所以值是不会变化的，就不会发生线程安全的问题！！！
  - 非零长度的数组总是可变的，客户端将能够修改数组的内容。 这是安全漏洞的！！！
    - 使公共数组私有并添加一个公共的不可变列表：Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));
    - 将数组设置为 private，并添加一个返回私有数组拷贝的公共方法：public static final Thing[] values() {
      return PRIVATE_VALUES.clone();
      }
    - 要在这些方法之间进行选择，请考虑客户端可能如何处理返回的结果。 哪种返回类型会更方便？ 哪个会更好的
      表现？
## 总而言之，应该尽可能地减少程序元素的可访问性（在合理范围内）。
- 在仔细设计一个最小化的公共 API 之后,你应该防止任何散乱的类，接口或成员成为 API 的一部分。 
- 除了作为常量的公共静态 final 属性之外，公共类不应该有公共属性。
- 确保 public static final 属性引用的对象是不可变的。